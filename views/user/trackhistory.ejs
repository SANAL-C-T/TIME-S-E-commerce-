<%- include("../partials/userloggedHeder.ejs") %>


<div class="container-fluid  d-flex ">
    <div class=" row">
        <nav class="sidebar">
            <ul>
                <li><a href="/Myprofile"><i class="fa-solid fa-address-card mx-3 " style="color: #fefefe;"> </i><span class="d-none d-sm-inline">My profile</span></a></li>
                <li><a href="/profileEdits"> <i class="fa-solid fa-user-pen mx-3" style="color: #fefefe;"> </i><span class="d-none d-sm-inline"> Edit profile</span></a></li>
                <li><a href="/changepassword"><i class="fa-solid fa-key mx-3" style="color: #fefefe;"> </i><span class="d-none d-sm-inline">set password</span></a></li>
                <li><a href="/wallet"><i class="fa-solid fa-wallet mx-3" style="color: #fefefe;"> </i><span class="d-none d-sm-inline">Wallet</span></a></li>
                <li><a href="/orderHistory"><i class="fa-solid fa-clock-rotate-left mx-3" style="color: #fefefe;"> </i><span class="d-none d-sm-inline">Order history</span></a></li>
                <li><a href="/savedaddress"><i class="fa-solid fa-address-book mx-3" style="color: #fefefe;"> </i><span class="d-none d-sm-inline">Saved address</span></a></li>
        
            </ul>
        </nav>
    </div>
  
    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4 d-flex flex-column  mx-3 ">
   
        <div class="table-responsive">
<br>
            <div class="text-center "><h5>ORDER HISTORY</h5></div>
            
                    <table id="example" class="table table-striped">
                        <thead>
                            <tr>
                                <th style="width: 5%;">SL NO</th>
                                <th style="width: 20%;">ORDER ID</th>
                                <th style="width: 15%;">ORDER DATE</th>
                                <th style="width: 15%;">TOTAL PRICE</th>
                                <th style="width: 10%;">STATUS</th>
                              
                                <th style="width: 10%;">ACTION</th>
                            </tr>
                        </thead>
                     <!--    <tbody>
                            <% cartHistory.forEach((order, orderIndex) => { %>
                                <% order.items.forEach((item, itemIndex) => { %>
                                    <tr>
                                        <td><%= orderIndex + 1 %></td>
                                        <td> <%=order._id%></td> 
                                        <td><%= order.OrderDate %></td>
                                        <td><%= item.price%></td>
                                        <td><%= order.Status %></td>
                                        <% if (order.Status !== "Shipped" && order.Status !== "Delivered") { %>
                                            <td>
                                                <form action="/orderCancel/<%= order.userid %>" method="POST">
                                                    <input type="hidden" name="index" value="<%= orderIndex%>">
                                                    <button type="submit" class="btn btn-danger" name="action" value="cancel">Cancel</button>
                                                </form>
                                            </td>
                                        <% } else { %>
                                            <td></td> <!-- Empty cell if status is Shipped or Delivered -->
                                        <% } %>
                                        
                                    </tr>
                                <% }); %>
                            <% }); %>
                        </tbody> -->
                        
                        <tbody>
                            <% cartHistory.forEach((order, orderIndex) => { %>
                                <tr>
                                    <td><%= orderIndex + 1 %></td>
                                    <td><%= order._id %></td>
                                    <td><%= order.OrderDate %></td>
                                    <td>&#8377; <%= order.OrderTotalPrice %></td>
                                    <td><%= order.Status %></td>
                                    <% if (order.Status !== "shipped" && order.Status !== "delivered" && order.Status !== "Cancel"&& order.Status !== "User cancelled" ) { %>
                                        <td>
                                            <form id="cancelForm<%= orderIndex %>" action="/orderCancel/<%= order._id %>" method="POST">
                                                <input type="hidden" name="index" value="<%= orderIndex %>">
                                                <button type="button" class="btn btn-danger" onclick="showCancelConfirmation(<%= orderIndex %>)">Cancel</button>
                                            </form>
                                        </td>
                                    <% } else { %>
                                        <td></td> 
                                    <% } %>
                                </tr>
                            <% }); %>
                        
                            <script>
                                function showCancelConfirmation(orderIndex) {
                                    Swal.fire({
                                        title: 'Are you sure?',
                                        text: 'You won\'t be able to revert this!',
                                        icon: 'warning',
                                        showCancelButton: true,
                                        confirmButtonColor: '#3085d6',
                                        cancelButtonColor: '#d33',
                                        confirmButtonText: 'Yes, cancel it!'
                                    }).then((result) => {
                                        if (result.isConfirmed) {
                                            
                                            document.getElementById(`cancelForm${orderIndex}`).submit();
                                        }
                                    });
                                }
                            </script>
                        </tbody>
                        
            
                    </table>
                </div>
            </div>

</main>



    </div>



</div>




                   


<%-include("../partials/footer.ejs")%>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
        body {
            font-family: 'Arial', sans-serif;
            background-color: rgb(242, 239, 239);
        }

        .sidebar {
            height: auto;
            width: 200px;
            background-color: #333;
            padding-top: 20px;
            color: white;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }

        .sidebar ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .sidebar li {
            padding: 15px;
            font-size: 14px;
            cursor: pointer;
            border-bottom: 1px solid #555;
            transition: background-color 0.3s;
        }

        .sidebar li:hover {
            background-color: #555;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
    
        .sidebar ul li a {
            text-decoration: none; 
            color: #fff;
            display: block;
        }

@media (max-width: 768px) {
    .sidebar{
        width:100%;
        padding:0px;
    }
}


#example_filter {
    float: right;
}



#example thead th {
    background-color: #3d3d3d; /* Set background color for header cells */
    color: #fff; /* Set text color for header cells */
}

#example tbody td {
    background-color: #ffffff; /* Set background color for body cells */
    color: #333; /* Set text color for body cells */
}

    </style>

  



<script>
    new DataTable("#example");
</script>

